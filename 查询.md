# æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Next.js å’Œ Supabase çš„æ ¸é…¸æ£€æµ‹ç»“æœåœ¨çº¿æŸ¥è¯¢ç³»ç»Ÿï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œã€é‚®ç®±éªŒè¯ã€ç™»å½•ã€æ‰¾å›å¯†ç å’Œç»“æœæŸ¥è¯¢åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [API æ¥å£æ–‡æ¡£](#api-æ¥å£æ–‡æ¡£)
- [é¡µé¢è·¯ç”±](#é¡µé¢è·¯ç”±)
- [é‚®ä»¶æ¨¡æ¿é…ç½®](#é‚®ä»¶æ¨¡æ¿é…ç½®)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… ç”¨æˆ·æ³¨å†Œï¼ˆå«é‚®ç®±éªŒè¯ï¼‰
- âœ… ç”¨æˆ·ç™»å½•ï¼ˆåŸºäº Supabase Authï¼‰
- âœ… æ‰¾å›å¯†ç ï¼ˆé‚®ç®±éªŒè¯ï¼‰
- âœ… å¯†ç é‡ç½®
- âœ… ä¼šè¯ç®¡ç†å’Œä¸­é—´ä»¶ä¿æŠ¤
- âœ… æ ¸é…¸æ£€æµ‹ç»“æœæŸ¥è¯¢ï¼ˆæ ¹æ®æ‰‹æœºå·å’Œèº«ä»½è¯å·åŒ¹é…ï¼‰
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- âœ… ç¾è§‚çš„åŒ»ç–—å¥åº·ä¸»é¢˜ UI

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Next.js 16 (App Router)
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS v4
- **UI ç»„ä»¶**: shadcn/ui
- **çŠ¶æ€ç®¡ç†**: React Hooks

### åç«¯
- **è®¤è¯**: Supabase Auth
- **æ•°æ®åº“**: PostgreSQL (é€šè¿‡ Supabase)
- **API**: Next.js API Routes
- **ä¼šè¯ç®¡ç†**: Supabase Session Management

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
# æˆ–
yarn install
# æˆ–
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env.local` å¹¶å¡«å†™ç›¸åº”çš„å€¼ï¼š

```bash
cp .env.example .env.local
```

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
# æˆ–
yarn dev
# æˆ–
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ã€‚

## âš™ï¸ ç¯å¢ƒé…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# PostgreSQL æ•°æ®åº“é…ç½®
POSTGRES_URL=your_postgres_connection_string
POSTGRES_PRISMA_URL=your_postgres_prisma_url
POSTGRES_URL_NON_POOLING=your_postgres_non_pooling_url
POSTGRES_USER=your_postgres_user
POSTGRES_PASSWORD=your_postgres_password
POSTGRES_DATABASE=your_postgres_database
POSTGRES_HOST=your_postgres_host

# Supabase å…¶ä»–é…ç½®
SUPABASE_JWT_SECRET=your_jwt_secret
SUPABASE_PUBLISHABLE_KEY=your_publishable_key
SUPABASE_SECRET_KEY=your_secret_key

# å¼€å‘ç¯å¢ƒé‡å®šå‘ URLï¼ˆå¯é€‰ï¼‰
NEXT_PUBLIC_DEV_SUPABASE_REDIRECT_URL=http://localhost:3000/results
```

### è·å– Supabase å‡­è¯

1. è®¿é—® [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©æˆ–åˆ›å»ºæ‚¨çš„é¡¹ç›®
3. åœ¨ **Settings** > **API** ä¸­æ‰¾åˆ°ï¼š
   - `Project URL` â†’ `NEXT_PUBLIC_SUPABASE_URL`
   - `anon/public key` â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `service_role key` â†’ `SUPABASE_SERVICE_ROLE_KEY`

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### æ ¸é…¸æ£€æµ‹ç»“æœè¡¨ (nucleic_acid_results)

è¯¥è¡¨å­˜å‚¨æ‰€æœ‰æ ¸é…¸æ£€æµ‹è®°å½•ï¼š

```sql
CREATE TABLE nucleic_acid_results (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,              -- å§“å
  id_number VARCHAR(18) NOT NULL,          -- èº«ä»½è¯å·
  phone VARCHAR(11) NOT NULL,              -- æ‰‹æœºå·
  test_date TIMESTAMP NOT NULL,            -- æ£€æµ‹æ—¥æœŸ
  test_location VARCHAR(255),              -- æ£€æµ‹åœ°ç‚¹
  result VARCHAR(20) NOT NULL,             -- æ£€æµ‹ç»“æœï¼ˆé˜´æ€§/é˜³æ€§ï¼‰
  specimen_type VARCHAR(50),               -- æ ‡æœ¬ç±»å‹
  test_method VARCHAR(50),                 -- æ£€æµ‹æ–¹æ³•
  report_date TIMESTAMP,                   -- æŠ¥å‘Šæ—¥æœŸ
  created_at TIMESTAMP DEFAULT NOW(),      -- è®°å½•åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMP DEFAULT NOW()       -- è®°å½•æ›´æ–°æ—¶é—´
);

-- åˆ›å»ºç´¢å¼•ä»¥æå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_phone ON nucleic_acid_results(phone);
CREATE INDEX idx_id_number ON nucleic_acid_results(id_number);
CREATE INDEX idx_test_date ON nucleic_acid_results(test_date DESC);
```

### æ’å…¥æµ‹è¯•æ•°æ®

```sql
INSERT INTO nucleic_acid_results (
  name, id_number, phone, test_date, test_location, 
  result, specimen_type, test_method, report_date
) VALUES (
  'å¼ ä¸‰', '110101199001011234', '13800138000', 
  '2024-01-15 10:30:00', 'åŒ—äº¬å¸‚æœé˜³åŒºæ£€æµ‹ç‚¹',
  'é˜´æ€§', 'å’½æ‹­å­', 'RT-PCR', '2024-01-15 18:00:00'
);
```

### Supabase Auth ç”¨æˆ·å…ƒæ•°æ®

ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œä»¥ä¸‹ä¿¡æ¯å­˜å‚¨åœ¨ Supabase Auth çš„ `user_metadata` ä¸­ï¼š

- `name`: ç”¨æˆ·å§“å
- `phone`: æ‰‹æœºå·
- `id_number`: èº«ä»½è¯å·

## ğŸ“¡ API æ¥å£æ–‡æ¡£

### 1. ç”¨æˆ·æ³¨å†Œ

**ç«¯ç‚¹**: `POST /api/auth/sign-up`

**è¯·æ±‚ä½“**:
```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "å¼ ä¸‰",
  "phone": "13800138000",
  "idNumber": "110101199001011234"
}
```

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com"
  },
  "message": "æ³¨å†ŒæˆåŠŸï¼è¯·æŸ¥çœ‹æ‚¨çš„é‚®ç®±å¹¶ç‚¹å‡»éªŒè¯é“¾æ¥ä»¥å®Œæˆæ³¨å†Œã€‚"
}
```

**å¤±è´¥å“åº”** (400/500):
```json
{
  "error": "é”™è¯¯ä¿¡æ¯"
}
```

**æµç¨‹è¯´æ˜**:
1. æ¥æ”¶ç”¨æˆ·æ³¨å†Œä¿¡æ¯
2. è°ƒç”¨ Supabase Auth åˆ›å»ºç”¨æˆ·
3. å°†å§“åã€æ‰‹æœºå·ã€èº«ä»½è¯å·å­˜å‚¨åœ¨ç”¨æˆ·å…ƒæ•°æ®ä¸­
4. å‘é€éªŒè¯é‚®ä»¶åˆ°ç”¨æˆ·é‚®ç®±
5. ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥å®ŒæˆéªŒè¯

### 2. é‚®ç®±éªŒè¯å›è°ƒ

**ç«¯ç‚¹**: `GET /auth/callback?code={verification_code}`

**åŠŸèƒ½**: å¤„ç† Supabase é‚®ç®±éªŒè¯å›è°ƒ

**æµç¨‹**:
1. Supabase å‘é€éªŒè¯é‚®ä»¶
2. ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥
3. é‡å®šå‘åˆ° `/auth/callback` å¹¶æºå¸¦éªŒè¯ç 
4. åç«¯éªŒè¯ä»£ç å¹¶åˆ›å»ºä¼šè¯
5. è‡ªåŠ¨è·³è½¬åˆ° `/results` é¡µé¢

### 3. ç”¨æˆ·ç™»å½•

**å®ç°ä½ç½®**: `app/auth/login/page.tsx` (å®¢æˆ·ç«¯è°ƒç”¨)

**ä»£ç ç¤ºä¾‹**:
```typescript
const supabase = createBrowserClient()
const { data, error } = await supabase.auth.signInWithPassword({
  email,
  password
})
```

**æµç¨‹**:
1. ç”¨æˆ·è¾“å…¥é‚®ç®±å’Œå¯†ç 
2. è°ƒç”¨ Supabase Auth è¿›è¡ŒéªŒè¯
3. éªŒè¯æˆåŠŸååˆ›å»ºä¼šè¯
4. è‡ªåŠ¨è·³è½¬åˆ° `/results` é¡µé¢

### 4. æ‰¾å›å¯†ç 

**å®ç°ä½ç½®**: `app/auth/forgot-password/page.tsx` (å®¢æˆ·ç«¯è°ƒç”¨)

**ä»£ç ç¤ºä¾‹**:
```typescript
const supabase = createClient()
const { error } = await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${window.location.origin}/auth/reset-password`
})
```

**æµç¨‹**:
1. ç”¨æˆ·è¾“å…¥æ³¨å†Œé‚®ç®±
2. è°ƒç”¨ Supabase Auth å‘é€å¯†ç é‡ç½®é‚®ä»¶
3. ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥
4. é‡å®šå‘åˆ° `/auth/reset-password` é¡µé¢
5. ç”¨æˆ·è¾“å…¥æ–°å¯†ç å¹¶ç¡®è®¤
6. å¯†ç é‡ç½®æˆåŠŸåè·³è½¬åˆ°ç™»å½•é¡µ

### 5. é‡ç½®å¯†ç 

**å®ç°ä½ç½®**: `app/auth/reset-password/page.tsx` (å®¢æˆ·ç«¯è°ƒç”¨)

**ä»£ç ç¤ºä¾‹**:
```typescript
const supabase = createClient()
const { error } = await supabase.auth.updateUser({
  password: newPassword
})
```

**æµç¨‹**:
1. ç”¨æˆ·ä»å¯†ç é‡ç½®é‚®ä»¶ç‚¹å‡»é“¾æ¥è¿›å…¥æ­¤é¡µé¢
2. è¾“å…¥æ–°å¯†ç å’Œç¡®è®¤å¯†ç 
3. è°ƒç”¨ Supabase Auth æ›´æ–°å¯†ç 
4. æ›´æ–°æˆåŠŸåè·³è½¬åˆ°ç™»å½•é¡µ

### 6. æŸ¥è¯¢æ ¸é…¸æ£€æµ‹ç»“æœ

**å®ç°ä½ç½®**: `app/results/page.tsx` (æœåŠ¡ç«¯ç»„ä»¶)

**æŸ¥è¯¢é€»è¾‘**:
```typescript
const supabase = await createClient()

// è·å–å½“å‰ç”¨æˆ·
const { data: { user } } = await supabase.auth.getUser()

// ä»ç”¨æˆ·å…ƒæ•°æ®ä¸­è·å–æ‰‹æœºå·å’Œèº«ä»½è¯å·
const phone = user.user_metadata.phone
const idNumber = user.user_metadata.id_number

// æŸ¥è¯¢åŒ¹é…çš„æ£€æµ‹ç»“æœ
const { data: results } = await supabase
  .from('nucleic_acid_results')
  .select('*')
  .or(`phone.eq.${phone},id_number.eq.${idNumber}`)
  .order('test_date', { ascending: false })
```

**è¿”å›æ•°æ®ç»“æ„**:
```typescript
interface NucleicAcidResult {
  id: number
  name: string
  id_number: string
  phone: string
  test_date: string
  test_location: string
  result: string
  specimen_type: string
  test_method: string
  report_date: string
  created_at: string
  updated_at: string
}
```

### 7. ç”¨æˆ·é€€å‡ºç™»å½•

**å®ç°ä½ç½®**: `app/results/page.tsx` (æœåŠ¡ç«¯ Action)

**ä»£ç ç¤ºä¾‹**:
```typescript
async function signOut() {
  "use server"
  const supabase = await createClient()
  await supabase.auth.signOut()
  redirect('/auth/login')
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
<form action={signOut}>
  <Button type="submit">é€€å‡ºç™»å½•</Button>
</form>
```

## ğŸ—º é¡µé¢è·¯ç”±

### å…¬å¼€è·¯ç”±

| è·¯ç”± | é¡µé¢ | è¯´æ˜ |
|------|------|------|
| `/` | é¦–é¡µ | ç³»ç»Ÿä»‹ç»å’Œå…¥å£ |
| `/auth/login` | ç™»å½•é¡µ | ç”¨æˆ·ç™»å½• |
| `/auth/sign-up` | æ³¨å†Œé¡µ | ç”¨æˆ·æ³¨å†Œ |
| `/auth/verify-email` | é‚®ç®±éªŒè¯æç¤º | æç¤ºç”¨æˆ·æŸ¥çœ‹é‚®ç®± |
| `/auth/forgot-password` | å¿˜è®°å¯†ç  | å‘é€å¯†ç é‡ç½®é‚®ä»¶ |
| `/auth/reset-password` | é‡ç½®å¯†ç  | è®¾ç½®æ–°å¯†ç  |
| `/auth/callback` | éªŒè¯å›è°ƒ | å¤„ç†é‚®ç®±éªŒè¯å›è°ƒ |

### å—ä¿æŠ¤è·¯ç”±

| è·¯ç”± | é¡µé¢ | è¯´æ˜ |
|------|------|------|
| `/results` | ç»“æœæŸ¥è¯¢é¡µ | æ˜¾ç¤ºç”¨æˆ·çš„æ ¸é…¸æ£€æµ‹ç»“æœ |

**ä¿æŠ¤æœºåˆ¶**: 
- ä½¿ç”¨ `proxy.ts` (middleware) æ£€æŸ¥ç”¨æˆ·ä¼šè¯
- æœªç™»å½•ç”¨æˆ·è®¿é—®å—ä¿æŠ¤è·¯ç”±å°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ

## ğŸ“§ é‚®ä»¶æ¨¡æ¿é…ç½®

### 1. é‚®ç®±éªŒè¯æ¨¡æ¿

åœ¨ Supabase Dashboard ä¸­é…ç½®é‚®ç®±éªŒè¯æ¨¡æ¿ã€‚

**é…ç½®è·¯å¾„**: `Authentication` > `Email Templates` > `Confirm signup`

**HTML æ¨¡æ¿**:

```html
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f0f9ff;">
  <table role="presentation" style="width: 100%; border-collapse: collapse;">
    <tr>
      <td align="center" style="padding: 40px 0;">
        <table role="presentation" style="width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);">
          <!-- Header -->
          <tr>
            <td style="padding: 48px 48px 32px; text-align: center; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); border-radius: 16px 16px 0 0;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">å¤©äº’ç”Ÿç‰©</h1>
              <p style="margin: 8px 0 0; color: #e0f2fe; font-size: 14px; font-weight: 500;">æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿ</p>
            </td>
          </tr>
          
          <!-- Content -->
          <tr>
            <td style="padding: 48px 48px 32px;">
              <h2 style="margin: 0 0 16px; color: #0f172a; font-size: 24px; font-weight: 600;">éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€</h2>
              <p style="margin: 0 0 24px; color: #475569; font-size: 16px; line-height: 1.6;">
                æ„Ÿè°¢æ‚¨æ³¨å†Œå¤©äº’ç”Ÿç‰©æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿã€‚è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€ä»¥å®Œæˆæ³¨å†Œæµç¨‹ã€‚
              </p>
              
              <!-- Button -->
              <table role="presentation" style="margin: 32px 0;">
                <tr>
                  <td align="center">
                    <a href="{{ .ConfirmationURL }}" style="display: inline-block; padding: 16px 48px; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); color: #ffffff; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 600; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);">
                      éªŒè¯é‚®ç®±åœ°å€
                    </a>
                  </td>
                </tr>
              </table>
              
              <p style="margin: 32px 0 0; color: #64748b; font-size: 14px; line-height: 1.6;">
                å¦‚æœæŒ‰é’®æ— æ³•ç‚¹å‡»ï¼Œè¯·å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ°æµè§ˆå™¨åœ°å€æ è®¿é—®ï¼š
              </p>
              <p style="margin: 12px 0 0; padding: 16px; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; color: #475569; font-size: 13px; word-break: break-all; font-family: 'Courier New', monospace;">
                {{ .ConfirmationURL }}
              </p>
            </td>
          </tr>
          
          <!-- Footer -->
          <tr>
            <td style="padding: 32px 48px 48px; border-top: 1px solid #e2e8f0;">
              <p style="margin: 0 0 8px; color: #94a3b8; font-size: 13px; line-height: 1.6;">
                <strong>é‡è¦æç¤ºï¼š</strong>è¯¥éªŒè¯é“¾æ¥å°†åœ¨ 24 å°æ—¶åå¤±æ•ˆã€‚
              </p>
              <p style="margin: 0; color: #94a3b8; font-size: 13px; line-height: 1.6;">
                å¦‚æœæ‚¨æ²¡æœ‰æ³¨å†Œæ­¤è´¦å·ï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ã€‚
              </p>
              <p style="margin: 24px 0 0; color: #cbd5e1; font-size: 12px; text-align: center;">
                Â© 2025 å¤©äº’ç”Ÿç‰© | æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿ
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
```

### 2. å¯†ç é‡ç½®æ¨¡æ¿

åœ¨ Supabase Dashboard ä¸­é…ç½®å¯†ç é‡ç½®æ¨¡æ¿ã€‚

**é…ç½®è·¯å¾„**: `Authentication` > `Email Templates` > `Reset Password`

**HTML æ¨¡æ¿**:

```html
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f0f9ff;">
  <table role="presentation" style="width: 100%; border-collapse: collapse;">
    <tr>
      <td align="center" style="padding: 40px 0;">
        <table role="presentation" style="width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);">
          <!-- Header -->
          <tr>
            <td style="padding: 48px 48px 32px; text-align: center; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); border-radius: 16px 16px 0 0;">
              <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">å¤©äº’ç”Ÿç‰©</h1>
              <p style="margin: 8px 0 0; color: #e0f2fe; font-size: 14px; font-weight: 500;">æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿ</p>
            </td>
          </tr>
          
          <!-- Content -->
          <tr>
            <td style="padding: 48px 48px 32px;">
              <h2 style="margin: 0 0 16px; color: #0f172a; font-size: 24px; font-weight: 600;">é‡ç½®æ‚¨çš„å¯†ç </h2>
              <p style="margin: 0 0 24px; color: #475569; font-size: 16px; line-height: 1.6;">
                æˆ‘ä»¬æ”¶åˆ°äº†æ‚¨çš„å¯†ç é‡ç½®è¯·æ±‚ã€‚è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¾ç½®æ–°å¯†ç ã€‚
              </p>
              
              <!-- Button -->
              <table role="presentation" style="margin: 32px 0;">
                <tr>
                  <td align="center">
                    <a href="{{ .ConfirmationURL }}" style="display: inline-block; padding: 16px 48px; background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); color: #ffffff; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 600; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);">
                      é‡ç½®å¯†ç 
                    </a>
                  </td>
                </tr>
              </table>
              
              <p style="margin: 32px 0 0; color: #64748b; font-size: 14px; line-height: 1.6;">
                å¦‚æœæŒ‰é’®æ— æ³•ç‚¹å‡»ï¼Œè¯·å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ°æµè§ˆå™¨åœ°å€æ è®¿é—®ï¼š
              </p>
              <p style="margin: 12px 0 0; padding: 16px; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; color: #475569; font-size: 13px; word-break: break-all; font-family: 'Courier New', monospace;">
                {{ .ConfirmationURL }}
              </p>
            </td>
          </tr>
          
          <!-- Footer -->
          <tr>
            <td style="padding: 32px 48px 48px; border-top: 1px solid #e2e8f0;">
              <p style="margin: 0 0 8px; color: #94a3b8; font-size: 13px; line-height: 1.6;">
                <strong>å®‰å…¨æç¤ºï¼š</strong>è¯¥é‡ç½®é“¾æ¥å°†åœ¨ 1 å°æ—¶åå¤±æ•ˆã€‚
              </p>
              <p style="margin: 0; color: #94a3b8; font-size: 13px; line-height: 1.6;">
                å¦‚æœæ‚¨æ²¡æœ‰è¯·æ±‚é‡ç½®å¯†ç ï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ï¼Œæ‚¨çš„å¯†ç ä¸ä¼šè¢«æ›´æ”¹ã€‚
              </p>
              <p style="margin: 24px 0 0; color: #cbd5e1; font-size: 12px; text-align: center;">
                Â© 2025 å¤©äº’ç”Ÿç‰© | æ ¸é…¸ç»“æœæŸ¥è¯¢ç³»ç»Ÿ
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
```

### é…ç½®æ­¥éª¤

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. å¯¼èˆªåˆ° **Authentication** > **Email Templates**
4. åˆ†åˆ«ç¼–è¾‘ **Confirm signup** å’Œ **Reset Password** æ¨¡æ¿
5. å°†ä¸Šè¿° HTML ä»£ç ç²˜è´´åˆ°å¯¹åº”çš„æ¨¡æ¿ç¼–è¾‘å™¨ä¸­
6. ç‚¹å‡» **Save** ä¿å­˜æ›´æ”¹

## ğŸ”’ ä¸­é—´ä»¶ä¿æŠ¤

### proxy.ts å·¥ä½œæµç¨‹

ç³»ç»Ÿä½¿ç”¨ä¸­é—´ä»¶ä¿æŠ¤éœ€è¦è®¤è¯çš„è·¯ç”±ï¼š

```typescript
// æ£€æŸ¥ç”¨æˆ·ä¼šè¯
const { data: { user } } = await supabase.auth.getUser()

// ä¿æŠ¤ /results è·¯ç”±
if (pathname.startsWith('/results')) {
  if (!user) {
    // æœªç™»å½•ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µ
    return NextResponse.redirect(new URL('/auth/login', request.url))
  }
}

// åˆ·æ–°ä¼šè¯ä»¤ç‰Œ
return response
```

## ğŸš¢ éƒ¨ç½²æŒ‡å—

### éƒ¨ç½²åˆ° Vercel

#### 1. æ¨é€ä»£ç åˆ° GitHub

```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin your-repo-url
git push -u origin main
```

#### 2. åœ¨ Vercel åˆ›å»ºé¡¹ç›®

1. è®¿é—® [Vercel Dashboard](https://vercel.com/dashboard)
2. ç‚¹å‡» **New Project**
3. å¯¼å…¥æ‚¨çš„ GitHub ä»“åº“
4. Vercel ä¼šè‡ªåŠ¨æ£€æµ‹ Next.js é¡¹ç›®

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š

1. è¿›å…¥é¡¹ç›®è®¾ç½®
2. é€‰æ‹© **Environment Variables**
3. æ·»åŠ æ‰€æœ‰ `.env.local` ä¸­çš„å˜é‡
4. æ³¨æ„ï¼š`NEXT_PUBLIC_DEV_SUPABASE_REDIRECT_URL` åº”è®¾ç½®ä¸ºç”Ÿäº§åŸŸå

#### 4. éƒ¨ç½²

- Vercel ä¼šè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²
- æ¯æ¬¡æ¨é€åˆ° `main` åˆ†æ”¯éƒ½ä¼šè§¦å‘è‡ªåŠ¨éƒ¨ç½²
- å¯åœ¨ Deployments æ ‡ç­¾æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

### Supabase ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 1. è®¾ç½®é‡å®šå‘ URL

1. è¿›å…¥ [Supabase Dashboard](https://supabase.com/dashboard)
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. å¯¼èˆªåˆ° **Authentication** > **URL Configuration**
4. åœ¨ **Redirect URLs** ä¸­æ·»åŠ ï¼š
   - `https://your-domain.com/auth/callback`
   - `https://your-domain.com/auth/reset-password`
5. ç‚¹å‡» **Save** ä¿å­˜

#### 2. é…ç½®é‚®ä»¶æ¨¡æ¿

æŒ‰ç…§ä¸Šè¿° [é‚®ä»¶æ¨¡æ¿é…ç½®](#é‚®ä»¶æ¨¡æ¿é…ç½®) éƒ¨åˆ†çš„è¯´æ˜é…ç½®é‚®ä»¶æ¨¡æ¿ã€‚

#### 3. SMTP è®¾ç½®ï¼ˆå¯é€‰ï¼‰

- é»˜è®¤ä½¿ç”¨ Supabase æä¾›çš„ SMTP æœåŠ¡
- ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®è‡ªå®šä¹‰ SMTP ä»¥æé«˜é‚®ä»¶é€è¾¾ç‡
- é…ç½®è·¯å¾„ï¼š**Settings** > **Auth** > **SMTP Settings**

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå˜é‡ç®¡ç†

- âŒ æ°¸è¿œä¸è¦å°† `.env.local` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… ä½¿ç”¨ Vercel ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… ä¸ºä¸åŒç¯å¢ƒè®¾ç½®ä¸åŒçš„å˜é‡å€¼ï¼ˆå¼€å‘/é¢„è§ˆ/ç”Ÿäº§ï¼‰

### 2. Supabase è¡Œçº§å®‰å…¨ (RLS)

ä¸º `nucleic_acid_results` è¡¨å¯ç”¨ RLS ç­–ç•¥ï¼š

```sql
-- å¯ç”¨ RLS
ALTER TABLE nucleic_acid_results ENABLE ROW LEVEL SECURITY;

-- å…è®¸ç”¨æˆ·åªæŸ¥çœ‹è‡ªå·±çš„è®°å½•
CREATE POLICY "Users can view own results" 
ON nucleic_acid_results
FOR SELECT
USING (
  phone = (auth.jwt() -> 'user_metadata' ->> 'phone')
  OR id_number = (auth.jwt() -> 'user_metadata' ->> 'id_number')
);
```

### 3. API å®‰å…¨

- æ‰€æœ‰æ•æ„Ÿæ“ä½œåœ¨æœåŠ¡ç«¯æ‰§è¡Œ
- `SUPABASE_SERVICE_ROLE_KEY` ä»…åœ¨æœåŠ¡ç«¯ API è·¯ç”±ä¸­ä½¿ç”¨
- å®¢æˆ·ç«¯ä»…ä½¿ç”¨ `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### 4. å¯†ç ç­–ç•¥

Supabase é»˜è®¤å¯†ç è¦æ±‚ï¼š
- æœ€å°‘ 6 ä¸ªå­—ç¬¦
- å¯åœ¨ Supabase Dashboard ä¸­é…ç½®æ›´å¼ºçš„å¯†ç ç­–ç•¥

## â“ å¸¸è§é—®é¢˜

### Q1: æ”¶ä¸åˆ°éªŒè¯é‚®ä»¶æˆ–å¯†ç é‡ç½®é‚®ä»¶ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
2. ç¡®è®¤ Supabase é‚®ä»¶é…ç½®æ­£ç¡®
3. æŸ¥çœ‹ Supabase Dashboard çš„ **Auth Logs**
4. è€ƒè™‘é…ç½®è‡ªå®šä¹‰ SMTP æœåŠ¡å™¨
5. ç¡®è®¤é‚®ä»¶æ¨¡æ¿å·²æ­£ç¡®é…ç½®

### Q2: ç™»å½•åä»ç„¶è·³è½¬åˆ°ç™»å½•é¡µï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ˜¯å¦å®Œæˆäº†é‚®ç®±éªŒè¯
2. æ¸…é™¤æµè§ˆå™¨ Cookies å’Œç¼“å­˜
3. æ£€æŸ¥ä¸­é—´ä»¶ `proxy.ts` æ˜¯å¦æ­£ç¡®é…ç½®
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
5. ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

### Q3: æŸ¥è¯¢ä¸åˆ°æ£€æµ‹ç»“æœï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æ•°æ®åº“ä¸­æœ‰åŒ¹é…çš„è®°å½•ï¼ˆæ‰‹æœºå·æˆ–èº«ä»½è¯å·ï¼‰
2. æ£€æŸ¥æ³¨å†Œæ—¶å¡«å†™çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®
3. åœ¨ Supabase Dashboard ä¸­ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
4. æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦é…ç½®æ­£ç¡®
5. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡ç«¯æ—¥å¿—

### Q4: å¯†ç é‡ç½®é“¾æ¥æ— æ•ˆæˆ–è¿‡æœŸï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤åœ¨ 1 å°æ—¶å†…ç‚¹å‡»äº†é‡ç½®é“¾æ¥
2. æ£€æŸ¥ Supabase é‡å®šå‘ URL é…ç½®
3. å°è¯•é‡æ–°è¯·æ±‚å¯†ç é‡ç½®
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### Q5: å¦‚ä½•åœ¨æœ¬åœ°å¼€å‘æ—¶æµ‹è¯•é‚®ä»¶åŠŸèƒ½ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
- Supabase ä¼šå‘é€çœŸå®é‚®ä»¶ï¼Œå³ä½¿åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ
- ç¡®ä¿ `NEXT_PUBLIC_DEV_SUPABASE_REDIRECT_URL` è®¾ç½®ä¸º `http://localhost:3000`
- æˆ–è€…ä½¿ç”¨ Supabase çš„ Inbucket æŸ¥çœ‹æµ‹è¯•é‚®ä»¶

### Q6: å¦‚ä½•æ›´æ”¹éƒ¨ç½²åŸŸåï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. æ›´æ–° Supabase çš„é‡å®šå‘ URL é…ç½®
2. æ›´æ–° Vercel ç¯å¢ƒå˜é‡
3. é‡æ–°éƒ¨ç½²åº”ç”¨

## ğŸ“š ç›¸å…³èµ„æº

- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [Supabase Auth æŒ‡å—](https://supabase.com/docs/guides/auth)
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)
- [shadcn/ui ç»„ä»¶](https://ui.shadcn.com)

## ğŸ“„ è®¸å¯è¯

MIT License

---

**å¼€å‘å›¢é˜Ÿ**: å¤©äº’ç”Ÿç‰©  
**é¡¹ç›®ç±»å‹**: æ ¸é…¸æ£€æµ‹ç»“æœæŸ¥è¯¢ç³»ç»Ÿ  
**æœ€åæ›´æ–°**: 2026å¹´
